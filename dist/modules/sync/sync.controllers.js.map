{"version":3,"sources":["../../../src/modules/sync/sync.controllers.ts"],"sourcesContent":["import path from 'node:path';\r\n\r\nimport fs from 'fs-extra';\r\n\r\nimport { Config, Contract } from '../../config/config.schemas.js';\r\n\r\nconst CONTRACT_DIR = path.join(process.cwd(), 'contract');\r\n\r\nexport async function fetchAndSaveExternalContract(contract: Contract, source: string): Promise<void> {\r\n  // Fetches an external contract from a given source and saves it to the local contract directory.\r\n  // Assumes the source URL provides a contract file at the endpoint 'contract?name={contract.name}'.\r\n\r\n  const response = await fetch(`${source}/contract?name=${contract.name}&emit=${contract.emit ?? false}`);\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch contract ${contract.name} from ${source}: ${response.status}`);\r\n  }\r\n\r\n  const content = await response.text();\r\n  const disposition = response.headers.get('Content-Disposition');\r\n  const fileName = disposition?.match(/filename=\"(.+?)\"/)?.[1];\r\n\r\n  if (!fileName) {\r\n    throw new Error(`Filename not found in Content-Disposition header from ${source}`);\r\n  }\r\n\r\n  const outputPath = path.join(CONTRACT_DIR, 'synced');\r\n  const fullPath = path.join(outputPath, fileName);\r\n\r\n  await fs.ensureDir(outputPath);\r\n  await fs.writeFile(fullPath, content, 'utf-8');\r\n\r\n  console.log(`ðŸ”— Fetched and saved contract: ${contract.name} as ${fileName} from ${source}`);\r\n}\r\n\r\nexport async function fetchExternalConfig(source: string): Promise<Config> {\r\n  // Fetches the external configuration from a given source URL.\r\n  // Assumes the source URL provides a JSON configuration at the endpoint 'contract/config'.\r\n\r\n  const response = await fetch(`${source}/contract/config`);\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch external config from ${source}: ${response.status}`);\r\n  }\r\n\r\n  return await response.json();\r\n}\r\n"],"mappings":";AAAA,OAAO,UAAU;AAEjB,OAAO,QAAQ;AAIf,IAAM,eAAe,KAAK,KAAK,QAAQ,IAAI,GAAG,UAAU;AAExD,eAAsB,6BAA6B,UAAoB,QAA+B;AAIpG,QAAM,WAAW,MAAM,MAAM,GAAG,MAAM,kBAAkB,SAAS,IAAI,SAAS,SAAS,QAAQ,KAAK,EAAE;AAEtG,MAAI,CAAC,SAAS,IAAI;AAChB,UAAM,IAAI,MAAM,4BAA4B,SAAS,IAAI,SAAS,MAAM,KAAK,SAAS,MAAM,EAAE;AAAA,EAChG;AAEA,QAAM,UAAU,MAAM,SAAS,KAAK;AACpC,QAAM,cAAc,SAAS,QAAQ,IAAI,qBAAqB;AAC9D,QAAM,WAAW,aAAa,MAAM,kBAAkB,IAAI,CAAC;AAE3D,MAAI,CAAC,UAAU;AACb,UAAM,IAAI,MAAM,yDAAyD,MAAM,EAAE;AAAA,EACnF;AAEA,QAAM,aAAa,KAAK,KAAK,cAAc,QAAQ;AACnD,QAAM,WAAW,KAAK,KAAK,YAAY,QAAQ;AAE/C,QAAM,GAAG,UAAU,UAAU;AAC7B,QAAM,GAAG,UAAU,UAAU,SAAS,OAAO;AAE7C,UAAQ,IAAI,yCAAkC,SAAS,IAAI,OAAO,QAAQ,SAAS,MAAM,EAAE;AAC7F;AAEA,eAAsB,oBAAoB,QAAiC;AAIzE,QAAM,WAAW,MAAM,MAAM,GAAG,MAAM,kBAAkB;AAExD,MAAI,CAAC,SAAS,IAAI;AAChB,UAAM,IAAI,MAAM,wCAAwC,MAAM,KAAK,SAAS,MAAM,EAAE;AAAA,EACtF;AAEA,SAAO,MAAM,SAAS,KAAK;AAC7B;","names":[]}