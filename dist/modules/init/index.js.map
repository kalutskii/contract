{"version":3,"sources":["../../../src/config/config.controllers.ts","../../../src/config/config.defaults.ts","../../../src/config/config.schemas.ts","../../../src/modules/init/init.controllers.ts","../../../src/modules/init/index.ts"],"sourcesContent":["import fs from 'fs-extra';\r\nimport prompts from 'prompts';\r\n\r\nimport { defaultConfig } from './config.defaults.js';\r\nimport { Config, ConfigSchema } from './config.schemas.js';\r\n\r\nconst CONFIG_FILE = 'contract.config.json';\r\n\r\n// Writes the default config to the config file.\r\nconst writeDefaultConfig = async () => fs.writeJson(CONFIG_FILE, defaultConfig, { spaces: 2 });\r\n\r\nasync function askForConfigRewrite(): Promise<boolean> {\r\n  // Prompt the user to confirm if they want to rewrite the config file with default values.\r\n\r\n  const response = await prompts({\r\n    type: 'confirm',\r\n    name: 'rewrite',\r\n    message: 'The config file is invalid, do you want to rewrite it with default values?',\r\n    initial: true,\r\n  });\r\n  return response.rewrite;\r\n}\r\n\r\nexport async function readConfigFile(): Promise<Config> {\r\n  // Check if the config file exists, if not, write the default config.\r\n  if (!(await fs.pathExists(CONFIG_FILE))) {\r\n    await writeDefaultConfig();\r\n  }\r\n\r\n  // Read and validate the config file (with zod).\r\n  const rawContent = await fs.readFile(CONFIG_FILE, 'utf8');\r\n  const parsedContent = ConfigSchema.safeParse(JSON.parse(rawContent));\r\n\r\n  // If the content is invalid, ask the user if they want to\r\n  // rewrite it with default values or throw an error.\r\n  if (!parsedContent.success) {\r\n    if (await askForConfigRewrite()) {\r\n      await writeDefaultConfig();\r\n      return defaultConfig;\r\n    } else throw new Error(`Invalid config file: ${parsedContent.error.message}`);\r\n  }\r\n\r\n  return parsedContent.data;\r\n}\r\n","import { Config } from './config.schemas.js';\r\n\r\nexport const defaultConfig: Config = {\r\n  $schema: 'https://raw.githubusercontent.com/kaluckii/contract/refs/heads/main/static/contract.schema.json',\r\n  appName: 'your-app',\r\n  externalSources: [],\r\n  contracts: [],\r\n};\r\n","import z from 'zod';\r\n\r\nexport const ContractSchema = z.object({\r\n  name: z.string(),\r\n  emit: z.boolean().optional(),\r\n});\r\n\r\nexport const ConfigSchema = z.object({\r\n  $schema: z.url(),\r\n  appName: z.string(),\r\n  externalSources: z.array(z.string()),\r\n  contracts: z.array(ContractSchema),\r\n});\r\n\r\nexport type Contract = z.infer<typeof ContractSchema>;\r\nexport type Config = z.infer<typeof ConfigSchema>;\r\n","import path from 'node:path';\r\n\r\nimport fs from 'fs-extra';\r\nimport prompts from 'prompts';\r\n\r\nimport { Contract } from '../../config/config.schemas.js';\r\n\r\nconst CONTRACT_DIR = path.join(process.cwd(), 'contract');\r\n\r\nexport async function ensureMissingSourceFiles(contracts: Contract[]): Promise<void> {\r\n  // Ensure that all source files for the contracts exist, creating them if necessary.\r\n\r\n  await Promise.all(\r\n    contracts.map(async (contract) => {\r\n      const filename = `contract.${contract.name}.source.ts`;\r\n      const destination = path.join(CONTRACT_DIR, 'source', filename);\r\n\r\n      const comment =\r\n        `// This file is pre-generated for contract: ${contract.name}\\n` +\r\n        (contract.emit ? '// !! Never re-export from index.ts ‚Äî use direct file exports.\\n' : '');\r\n\r\n      if (!(await fs.pathExists(destination))) {\r\n        await fs.writeFile(destination, comment);\r\n        console.log(`‚úÖ Created source file: ${filename}`);\r\n      }\r\n    })\r\n  );\r\n}\r\n\r\nasync function askForRewriteDirectory(): Promise<boolean> {\r\n  // Prompt the user to confirm if they want to rewrite the config file with default values.\r\n\r\n  const response = await prompts({\r\n    type: 'confirm',\r\n    name: 'rewrite',\r\n    message: 'The contract directory already exists. Do you want to rewrite it?',\r\n    initial: true,\r\n  });\r\n\r\n  return response.rewrite;\r\n}\r\n\r\nexport async function ensureContractDirectory(): Promise<void> {\r\n  // Rewrite the contract directory by removing it and creating a new one.\r\n\r\n  if (await fs.pathExists(CONTRACT_DIR)) {\r\n    if (await askForRewriteDirectory()) {\r\n      await fs.remove(CONTRACT_DIR);\r\n      await fs.ensureDir(CONTRACT_DIR);\r\n    } else return console.log('‚ùå Contract directory already exists, aborting initialization.');\r\n  }\r\n\r\n  await fs.ensureDir(CONTRACT_DIR);\r\n\r\n  console.log('üìÇ Contract directory ensured.');\r\n}\r\n\r\nexport async function createContractFolders(): Promise<void> {\r\n  // Initialize the contract directory structure with necessary subdirectories.\r\n\r\n  await fs.ensureDir(path.join(CONTRACT_DIR, 'source'));\r\n  await fs.ensureDir(path.join(CONTRACT_DIR, 'export'));\r\n  await fs.ensureDir(path.join(CONTRACT_DIR, 'synced'));\r\n\r\n  console.log('üìÇ Contract folders created.');\r\n}\r\n","import { readConfigFile } from '../../config/config.controllers.js';\r\nimport type { Contract } from '../../config/config.schemas.js';\r\nimport { createContractFolders, ensureContractDirectory, ensureMissingSourceFiles } from './init.controllers.js';\r\n\r\nasync function initContractStructure({ contracts }: { contracts: Contract[] }): Promise<void> {\r\n  // Ensure the contract directory is clean and set up the necessary folders and files,\r\n  // including the configuration files and source files for the contracts.\r\n\r\n  await ensureContractDirectory();\r\n  await createContractFolders();\r\n  await ensureMissingSourceFiles(contracts);\r\n\r\n  console.log('‚úÖ Contract structure initialized.');\r\n}\r\n\r\nexport async function runCommand({ ensureSources = false }: { ensureSources?: boolean } = {}): Promise<void> {\r\n  // Entry point for initializing the contract structure or only ensuring source files.\r\n\r\n  const config = await readConfigFile();\r\n\r\n  if (ensureSources) {\r\n    return await ensureMissingSourceFiles(config.contracts);\r\n  }\r\n\r\n  await initContractStructure({ contracts: config.contracts });\r\n}\r\n"],"mappings":"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","names":["fs","prompts"]}